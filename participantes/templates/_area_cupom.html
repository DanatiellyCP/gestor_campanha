{% extends 'base_2.html' %}
{% load static extras %}

{% block title %}Detalhes do Documento Fiscal{% endblock %}

{% block content %}
{% include 'includes/header_3.html' %}

<div class="container" style="margin: 5%; padding: 5%;">

  <div class="row mb-4">
    <div class="col-md-6">
      <h5>Dados do Documento:</h5>
      <ul class="list-group">

        {% if dados_json.emitente %}
          <li class="list-group-item"><strong>Loja:</strong> {{ dados_json.emitente.nome_razao_social|default:"-" }}</li>
          <li class="list-group-item"><strong>CNPJ:</strong> {{ dados_json.emitente.cnpj|default:"-" }}</li>
          <li class="list-group-item"><strong>Endereço:</strong> {{ dados_json.emitente.endereco|default:"-" }}</li>

          {% if cupom.modelo == "59" %}
            <li class="list-group-item"><strong>Bairro:</strong> {{ dados_json.emitente.bairro|default:"-" }}</li>
            <li class="list-group-item"><strong>Município:</strong> {{ dados_json.emitente.municipio|default:"-" }}</li>
            <li class="list-group-item"><strong>SAT Nº Série:</strong> {{ dados_json.sat_numero_serie|default:"-" }}</li>
          
          {% elif cupom.modelo == "65" %}
            <li class="list-group-item"><strong>Município:</strong> {{ dados_json.emitente.municipio|default:"-" }}</li>
            <li class="list-group-item"><strong>QR Code:</strong> {{ dados_json.qr_code|default:"-" }}</li>

          {% elif cupom.modelo == "55" %}
            <li class="list-group-item"><strong>Município:</strong> {{ dados_json.emitente.municipio|default:"-" }}</li>
            <li class="list-group-item"><strong>UF:</strong> {{ dados_json.emitente.uf|default:"-" }}</li>
          {% endif %}
        
        {% else %}
          <li class="list-group-item text-danger">Dados do emitente não disponíveis.</li>
        {% endif %}

        <li class="list-group-item"><strong>Data:</strong> {{ dados_json.data_hora_emissao|default:"-" }}</li>
        <li class="list-group-item"><strong>Total:</strong> R$ {{ dados_json.valor_total|floatformat:2|default:"0,00" }}</li>
        <li class="list-group-item"><strong>Forma de Pagamento:</strong> {{ dados_json.forma_pagamento|default:"-" }}</li>
        <li class="list-group-item"><strong>Chave de Acesso:</strong> {{ dados_json.chave_acesso|default:"-" }}</li>
      </ul>
    </div>

    <div class="col-md-6">
      <h5 class="mt-4">Produtos</h5>
      <ul class="list-group">
        {% if dados_json.produtos %}
          {% for produto in dados_json.produtos %}
            <li class="list-group-item">
              {% if dados_cupom.tipo_documento == 'SAT-cfe' %}
                <strong>{{ produto.item|default:"" }}. {{ produto.descricao|default:"-" }}</strong><br>
              {% else %}
                <strong>{{ produto.codigo|default:"" }} - {{ produto.descricao|default:"-" }}</strong><br>
              {% endif %}
              
              {{ produto.quantidade|default:"1" }} × 
              R$ {{ produto.valor_unitario|floatformat:2|default:"0,00" }} = 
              R$ {{ produto.valor_total_item|floatformat:2|default:"0,00" }}
            </li>
          {% endfor %}
        {% else %}
          <li class="list-group-item">Nenhum produto encontrado.</li>
        {% endif %}
      </ul>
    </div>
  </div>

  {% if cupom.ocr_text %}
    <div class="mb-4">
      <h5>Texto completo extraído do documento (OCR):</h5>
      <pre class="bg-light p-3 border rounded" style="white-space: pre-wrap;">{{ cupom.ocr_text|default:"-" }}</pre>
    </div>
  {% endif %}

  {% if dados_cupom %}
    <div class="mb-4">
      <h5>Dados Extraídos:</h5>
      <ul class="list-group">
        {% for key, value in dados_cupom.items %}
          <li class="list-group-item">
            <strong>{{ key }}:</strong> {{ value }}
          </li>
        {% endfor %}
      </ul>
    </div>
  {% else %}
    <p>Nenhum dado adicional disponível.</p>
  {% endif %}

</div>
{% endblock %}
