{% extends "base.html" %}

{% block title %}Detalhes do Cupom{% endblock %}

{% block content %}

  {% include 'includes/header_3.html' %}

  <div class="container mt-3">

    <h3 style="color: #263A7C; font-size:22px; font-family: Segoe UI; text-align:left;">
      Status do Cupom:
    </h3>

    <div class="container-fluid text-center mt-4">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Status</th>
            <th>Imagem Enviada</th>
            <th>Loja</th>
            <th>CNPJ</th>
            <th>Documento</th>
            <th>Número Documento</th>
            <th>Valor Total</th>
            <th>Data de Cadastro</th>
            <th>Hora de Cadastro</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              {% if cupom.status == 'Pendente' %}
                Aguardando Validação
              {% else %}
                {{ cupom.status }}
              {% endif %}
            </td>
            <td>
              <!-- Botão que abre modal -->
              <button type="button" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#cupomModal">
                Visualizar
              </button>
            </td>
            <td>{{ cupom.nome_loja }}</td>
            <td>{{ cupom.cnpj_loja }}</td>
            <td>{{ cupom.tipo_documento }}</td>
            <td>{{ cupom.numero_documento }}</td>
            <td>{{ cupom.valor_total }}</td>
            <td>{{ cupom.data_cadastro }}</td>
            <td>{{ cupom.hora_cadastro }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="cupomModal" tabindex="-1" aria-labelledby="cupomModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="cupomModalLabel">Detalhes do Cupom #{{ cupom.id }}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
          </div>
          <div class="modal-body">
            {% if cupom.imagem_cupom %}
              <img src="{{ cupom.imagem_cupom.url }}" alt="Imagem do cupom" class="img-fluid mb-3" />
            {% else %}
              <p><em>Imagem do cupom não disponível.</em></p>
            {% endif %}

            <h6>Texto extraído do cupom:</h6>
            <textarea class="form-control" rows="15" readonly>{{ cupom.dados_cupom }}</textarea>
          </div>
          <div class="modal-footer">
            <a href="{% url 'dados_cupom' cupom.id %}" class="btn btn-info">Ler Cupom</a>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>

  </div>

{% endblock %}

{% block extra_js %}
  <!-- Bootstrap 5 JS Bundle (Popper + Bootstrap) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
