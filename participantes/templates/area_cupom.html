{% extends 'base_2.html' %}
{% load static %}

{% block title %}Detalhes do Cupom{% endblock %}

{% block content %}
{% include 'includes/header_3.html' %}

<div class="container" style="margin: 5%; padding: 5%;">
  <div class="row mb-4">
    <div class="col-md-6">
      <h5>Dados do Cupom:</h5>
      <ul class="list-group">
        {% if dados_cupom.emitente %}
          <li class="list-group-item"><strong>Loja:</strong> {{ dados_cupom.emitente.nome_razao_social|default:"-" }}</li>
          <li class="list-group-item"><strong>CNPJ:</strong> {{ dados_cupom.emitente.cnpj|default:"-" }}</li>
          <li class="list-group-item"><strong>Endereço:</strong> {{ dados_cupom.emitente.endereco|default:"-" }}</li>
          <li class="list-group-item"><strong>Bairro:</strong> {{ dados_cupom.emitente.bairro|default:"-" }}</li>
          <li class="list-group-item"><strong>Município:</strong> {{ dados_cupom.emitente.municipio|default:"-" }}</li>
        {% else %}
          <li class="list-group-item text-danger">Dados do emitente não disponíveis.</li>
        {% endif %}
        <li class="list-group-item"><strong>Data:</strong> {{ dados_cupom.data_hora_emissao|default:"-" }}</li>
        <li class="list-group-item"><strong>Total:</strong> R$ {{ dados_cupom.valor_total|floatformat:2|default:"0,00" }}</li>
        <li class="list-group-item"><strong>Forma de Pagamento:</strong> {{ dados_cupom.forma_pagamento|default:"-" }}</li>
        <li class="list-group-item"><strong>SAT:</strong> {{ dados_cupom.sat_numero_serie|default:"-" }}</li>
        <li class="list-group-item"><strong>Chave QR:</strong> {{ dados_cupom.chave_acesso|default:"-" }}</li>
      </ul>
    </div>

    <div class="col-md-6">
      <h5 class="mt-4">Produtos</h5>
      <ul class="list-group">
        {% if dados_cupom.produtos %}
          {% for produto in dados_cupom.produtos %}
            <li class="list-group-item">
              <strong>{{ produto.item|default:"" }}. {{ produto.descricao|default:"-" }}</strong><br>
              {{ produto.quantidade|default:"1" }} × 
              R$ {{ produto.valor_unitario|floatformat:2|default:"0,00" }} = 
              R$ {{ produto.valor_total_item|floatformat:2|default:"0,00" }}
            </li>
          {% endfor %}
        {% else %}
          <li class="list-group-item">Nenhum produto encontrado.</li>
        {% endif %}
      </ul>
    </div>
  </div>

  {% if cupom.dados_cupom %}
    <div class="mb-4">
      <h5>Texto completo extraído do cupom (OCR):</h5>
      <pre class="bg-light p-3 border rounded" style="white-space: pre-wrap;">{{ cupom.ocr_text|default:"-" }}</pre>
    </div>
  {% endif %}
</div>
{% endblock %}
